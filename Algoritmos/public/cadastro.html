<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vagas IQ | Home </title>
    <link rel="icon" href="assets/VagasIQ.svg">

    <link rel="stylesheet" href="styles/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Unbounded:wght@200..900&display=swap"
        rel="stylesheet">

</head>

<body>

    <div class="header">
        <div class="div_container-navbar">
            <div class="div_logo">
                <h1><a href="index.html">VagasIQ</a></h1>
            </div>
            <div class="navbar">
                <a href="index.html#sobreNos">SOBRE NÓS</a>
                <a href="index.html#solucao">SOLUÇÕES</a>
                <a href="index.html#contato">CONTATO</a>
                <a href="calculadora.html">SIMULADOR</a>
                <a href="login.html" style="color: #ffc714"><u>LOGIN</u></a>
            </div>
        </div>
    </div>

    <div class="div_conteudo-cadastro">

        <div class="titulo">
            <h2>Crie a Sua Conta</h2>
            <h3>Crie uma conta vinculada a sua Instituição e tenha acesso à<br> infomações relevantes para o seu
                negócio!</h3>
        </div>
        <div class="div_forms">
            <div class="campo">
                <p>Código de acesso<span style="color: red; font-weight: bold;" id="erroCodigo"></span></p>
                <input type="text" class="input_cad-log" id="input_codigo" placeholder="Código">
            </div>
            <div class="campo">
                <p>Nome<span style="color: red; font-weight: bold;" id="erroNome"></span></p>
                <input type="text" class="input_cad-log" id="input_nome" placeholder="Seu Nome">
            </div>
            <div class="campo">
                <p>CPF<span style="color: red; font-weight: bold;" id="erroCpf"></span></p>
                <input type="text" class="input_cad-log" id="input_cpf" placeholder="Seu CPF">
            </div>
            <div class="campo">
                <p>Email<span style="color: red; font-weight: bold;" id="erroEmail"></span></p>
                <input type="text" class="input_cad-log" id="input_email" placeholder="exemplo@gmail.com">
            </div>
            <div class="campo">
                <p>Senha<span style="color: red; font-weight: bold;" id="erroSenha"></span></p>
                <input oninput="verificar()" type="text" class="input_cad-log" id="input_senha" placeholder="********">
            </div>
            <div class="campo">
                <p>Confirme a senha<span style="color: red; font-weight: bold;" id="erroConfirmacao"></span></p>
                <input type="text" class="input_cad-log" id="input_confirmacao" placeholder="********">
            </div>
            <button onclick="cadastrar()" class="button-forms">Cadastrar</button>
            <h4>Já possui uma conta? <a href="login.html">Clique aqui</a></h4>

        </div>


    </div>

    <div class="div_container-footer">

        <div class="div_conteudo-footer">

            <div class="div_titulo-footer">
                <h1>VagasIQ</h1>
            </div>

            <div class="traco"></div>

            <span class="div_descricao-footer"> Explore todo o potencial do seu negócio com o poder da tomada de decisão
                estratégica <br> baseada em informações relevantes! </span>

        </div>

</body>

</html>

<script>
    var listaSeguradorasCadastradas = [];
    window.onload = listar();

    function verificar() {
        var senha = input_senha.value;
        var mensagemErro = '';
        var listaCaracteres = ['@', '#', '$', '%', '&', '!', 0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
        var temCaracter = false;

        for (var f = 0; f < listaCaracteres.length; f++) {
            var caracterAtual = listaCaracteres[f];

            if (senha.includes(caracterAtual)) {
                temCaracter = true;
            }
        }

        if (temCaracter && senha.length >= 6) {
            mensagemErro = ' Senha forte!';
            erroSenha.style.color = 'green';
        } else {
            mensagemErro = ' Senha fraca!';
            erroSenha.style.color = 'red';
        }

        erroSenha.innerHTML = mensagemErro;
    }

    function cadastrar() {
        var codigo = input_codigo.value;
        var nome = input_nome.value;
        var cpf = input_cpf.value;
        var email = input_email.value;
        var senha = input_senha.value;
        var confirmacao = input_confirmacao.value;
        var idSeguradoraVincular;


        if (codigo == "") {
            erroCodigo.innerHTML = "*";
        }
        else if (nome == "") {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "*";
        }
        else if (cpf == "") {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "";
            erroCpf.innerHTML = "*";
        }

        else if (!email.includes("@") || email == "") {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "";
            erroCpf.innerHTML = "";
            erroEmail.innerHTML = "*";
        }

        else if (senha == '') {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "";
            erroCpf.innerHTML = "";
            erroEmail.innerHTML = "";
            erroSenha.innerHTML = "*";
        }

        else if (confirmacao != senha || confirmacao == "") {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "";
            erroCpf.innerHTML = "";
            erroEmail.innerHTML = "";
            erroConfirmacao.innerHTML = "*";

        }
        else {
            erroCodigo.innerHTML = "";
            erroNome.innerHTML = "";
            erroCpf.innerHTML = "";
            erroEmail.innerHTML = "";
            erroSenha.innerHTML = "";
            erroConfirmacao.innerHTML = "";

            for (let i = 0; i < listaSeguradorasCadastradas.length; i++) {
                if (listaSeguradorasCadastradas[i].codigo == codigo) {
                    idSeguradoraVincular = listaSeguradorasCadastradas[i].id_seguradora;
                    console.log("Código de ativação válido.");
                    break;
                } else {
                    // cardErro.style.display = "block";
                    // mensagem_erro.innerHTML = "(Mensagem de erro para código inválido)";
                    console.log("Código de ativação inválido.");
                    erroCodigo.innerHTML = "*";
                    // finalizarAguardar();
                }
            }

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nome,
                    emailServer: email,
                    cpfServer: cpf,
                    senhaServer: senha,
                    idSeguradoraVincularServer: idSeguradoraVincular
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        // cardErro.style.display = "block";

                        // mensagem_erro.innerHTML =
                        //     "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                        setTimeout(() => {
                            window.location = "login.html";
                        }, "2000");

                        // limparFormulario();
                        // finalizarAguardar();
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                    // finalizarAguardar();
                });

            return false;
        }
    }


    function listar() {
        fetch("/seguradoras/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((seguradoras) => {
                    seguradoras.forEach((seguradora) => {
                        listaSeguradorasCadastradas.push(seguradora);

                        console.log("listaSeguradorasCadastradas")
                        console.log(listaSeguradorasCadastradas[0].codigo)
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }
</script>